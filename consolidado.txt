# Documentación Consolidada de Herramientas de Seguridad

## 1. Investigación Forense Digital

### Fundamentos
- La investigación forense digital es la ciencia detrás de la resolución de delitos relacionados con la información y los datos informáticos.
- Los especialistas utilizan sus conocimientos para buscar evidencia que determine los hechos de los delitos informáticos.

### Preguntas Clave
- ¿Quién llevó a cabo el ataque?
- ¿Cuándo ocurrió el ataque?
- ¿Qué servidores o estaciones de trabajo resultaron perjudicados?
- ¿Cuáles fueron los motivos y objetivos de los atacantes?

### Primeros Pasos ante un Incidente
- Aislar los ordenadores comprometidos
- Recopilar información sin destruir indicadores de compromiso
- Reconfigurar reglas de enrutamiento en lugar de desconectar físicamente
- Recopilar información de RAM y Disco Duro

## 2. Herramientas de Análisis

### FTK Imager
- Permite guardar imágenes de unidades en uso
- Características principales:
  - Copia de memoria de acceso aleatorio
  - Se recomienda adjuntar pagefile.sys
  - Permite montar imágenes para análisis detallado

### Belkasoft Live RAM Capturer
- Alternativa cuando otras apps evitan la captura de memoria
- Permite evadir protecciones de memoria

### Autopsy
- GUI de Sleuth Kit
- Características:
  - Análisis de archivos eliminados
  - Detección de extensiones incorrectas
  - Análisis de marcas de tiempo
  - Construcción de líneas de tiempo

## 3. Análisis de Registros de Windows

### Eventos Importantes
- 4624: Inicio de sesión exitoso
- 4625: Inicio de sesión fallido
- 4634: Cierre de sesión
- 4648: Inicio de sesión con credenciales explícitas
- 4672: Asignación de privilegios especiales
- 4673: Operación con privilegios especiales
- 4768: Solicitud de ticket Kerberos (TGT)
- 4769: Solicitud de ticket de servicio Kerberos (TGS)

### Tipos de Inicio de Sesión
- Logon type 2: Interactive (teclado y pantalla)
- Logon type 3: Network (a través de la red)
- Logon type 4: Batch (tarea programada)
- Logon type 5: Service (servicio)
- Logon type 10: Remote Interactive (RDP)

## 4. Phishing y OSINT

### Análisis de Correos Electrónicos
- Búsqueda en Microsoft Exchange usando PowerShell
- Comandos principales:
  ```powershell
  Get-Mailbox | Search-mailbox -TargetMailbox admin@dominio.com –TargetFolder Resultados -SearchQuery ""
  ```
- Parámetros importantes:
  - Get-Mailbox: Enumera buzones
  - Search-Mailbox: Realiza búsquedas
  - TargetMailbox: Define buzón destino
  - TargetFolder: Carpeta para resultados
  - SearchQuery: Consulta de búsqueda
  - LogOnly: Verificación sin modificar
  - LogLevel: Nivel de detalle

### Detección de Phishing
- Análisis de remitentes sospechosos
- Búsqueda de patrones comunes
- Verificación de URLs maliciosas
- Análisis de archivos adjuntos
- Detección de campañas masivas
- Uso de operadores lógicos (OR, AND)

### Herramientas de Verificación
- TrueURL: Decodificación de URLs
- PhishTank: Verificación de phishing
- VirusTotal: Análisis de URLs
- DNS Checker: Verificación de DNS
- WhatsMyDNS: Propagación DNS
- Site24x7: Herramientas DNS

### Análisis de Encabezados
- SPF (Sender Policy Framework)
  - Verificación de servidores remitentes
  - Autenticación de correo
  - Protección contra suplantación
- DKIM (DomainKeys Identified Mail)
  - Firmas digitales
  - Autenticación de dominio
  - Verificación de integridad

### OSINT (Open Source Intelligence)
- Herramientas principales:
  - Recon-ng
  - Shodan
  - Google/Yandex/Baidu
- Etapas de auditoría:
  1. Conformación de objetivos
  2. Búsqueda dirigida
- Tablas en Recon-ng:
  - domains
  - companies
  - ports
  - hosts
  - contacts
  - credentials

### Comandos Recon-ng
```bash
show schema          # Ver estructura de tablas
show table_name      # Ver contenido de tabla
add table_name v1 v2 # Añadir registro
load module_name     # Cargar módulo
use module_name      # Usar módulo
run                  # Ejecutar módulo
show modules         # Listar módulos
```

### Shodan
- Búsqueda de dispositivos conectados
- Análisis de servicios
- Detección de vulnerabilidades
- Identificación de sistemas operativos
- Búsqueda de servicios expuestos

## 5. PUP y Exploits

### Documentos Maliciosos
- Ataques por correo electrónico
  - Ingeniería social
  - Archivos adjuntos disfrazados
  - Macros en documentos
  - Exploits en documentos
- Exploits
  - Subtipo de malware
  - Aprovechan vulnerabilidades
  - No requieren acción del usuario
  - Kits de exploits
  - Sistemas de envío
  - Medidas preventivas

### Análisis de Comportamiento
- Process Monitor (Procmon)
  - Monitoreo de llamadas del sistema
  - Interacción con sistema de archivos
  - Interacción con registro
  - Actividad de red
  - Actividad de procesos
- Características
  - Columnas personalizadas
  - Filtrado por proceso
  - Análisis estadístico
  - Filtros avanzados

### PUP (Potentially Unwanted Programs)
- Tipos
  - Adware
  - Pornware
  - Riskware
- Distribución
  - Software gratuito
  - Programas de socios
  - Instaladores
- Características
  - Firma digital
  - Funciones legítimas
  - Uso potencialmente malicioso

### Análisis de Software
- Métodos
  1. Análisis estático
     - Antivirus
     - Búsqueda en Internet
     - Observación de contenido
  2. Análisis dinámico
     - Eventos del sistema
     - Actividad de red
  3. Análisis exhaustivo
     - Depurador
     - Desensamblador

### Funciones Hash
- Características
  - Transformación matemática
  - Longitud fija
  - Unicidad
- Algoritmos
  - CRC32 (32 bits)
  - MD5 (128 bits)
  - SHA-1 (160 bits)
  - SHA-256 (256 bits)
- Herramientas
  - Hashdeep
  - Modo recursivo
  - CLI

### Adware
- Características
  - Muestra publicidad
  - Redirecciona búsquedas
  - Recopila información
- Distribución
  - Software gratuito
  - Drive-by-Download
- Eliminación
  - Complementos de navegador
  - Procesos maliciosos
  - Herramientas especializadas

### Análisis Automático
- Entornos de prueba
  - Cuckoo Sandbox
  - Malwr.com
- Características
  - Registro de API
  - Tráfico de red
  - Archivos creados
  - Memoria de procesos
  - Capturas de pantalla
- Firmas
  - Identificación de tipo
  - Cambios en sistema
  - Clasificación

### Detección de Máquinas Virtuales
- Comprobaciones
  - Claves de registro
  - Procesos en ejecución
  - Número de serie de disco
- Mecanismos de defensa
  - Evasión de análisis
  - Comportamiento alternativo

## 6. Netflow y Análisis de Red

### Protocolo Netflow
- Desarrollado por Cisco Systems
- Recopila información estadística de la red
- Estructura:
  - Sensor (enrutador Cisco)
  - Colector
  - Analizador

### Puertos y Seguridad
- Puertos del sistema (0-1023)
- Puertos personalizados (1024-49151)
- Puertos dinámicos (49151-65535)

### ntopng
- Herramienta de análisis y supervisión en tiempo real
- Características:
  - Historial de conexiones
  - Análisis de red/detección
  - Seguimiento de nuevas conexiones
  - Detección de llamadas de malware

## 7. Seguridad en Active Directory

### LAPS (Local Administrator Password Solution)
- Herramienta de Microsoft para gestionar contraseñas de administrador local
- Características:
  - Cambio periódico de contraseñas
  - Almacenamiento seguro en AD
  - Control de acceso granular

### Comandos LAPS
```powershell
# Asignación de permisos de autoadministración
Set-AdmPwdComputerSelfPermission -OrgUnit PCs

# Permiso para leer contraseñas
Set-AdmPwdReadPasswordPermission -OrgUnit PCs -AllowedPrincipals 'OMEGAB2B\Domain admins', servicedesk

# Permiso para restablecer contraseñas
Set-AdmPwdResetPasswordPermission -OrgUnit PCs -AllowedPrincipals 'OMEGAB2B\Domain admins', servicedesk
```

### Verificación de Contraseñas
- Uso de API Have I Been Pwned
- Cumplimiento con NIST 800-63B
- Recomendaciones:
  - Verificación periódica
  - No forzar cambios frecuentes
  - Uso de contraseñas seguras

## 8. Herramientas y Scripts

### Scripts de Análisis
- event_log_analyzer.py: Análisis de registros de Windows
- memory_analyzer.py: Análisis de volcados de memoria
- disk_analyzer.py: Análisis forense de discos
- netflow_analyzer.py: Análisis de tráfico de red
- timeline_builder.py: Construcción de líneas de tiempo

### Herramientas Principales
- Process Hacker
- Process Explorer
- Event Log Explorer
- Autopsy
- ntopng
- Fiddler
- Autoruns
- FTK Imager
- LAPS
- PingCastle
- Have I Been Pwned API
- CyberChef
- Recon-ng
- Shodan
- BuiltWith
- HackerTarget
- FreeGeoIP
- Belkasoft Live RAM Capturer
- Sleuth Kit
- Netflow Analyzer

## 6. Seguridad de Servidores

### Ataques Comunes
- 80% de ataques son generalizados
- Adivinación de contraseñas (RDP, MSSQL)
- Explotación de vulnerabilidades conocidas
- Servicios vulnerables expuestos

### Higiene Cibernética
1. Conocerse a uno mismo
   - Inventario de sistemas
   - Gestión de configuración
2. Prepararse para lo peor
   - Copias de seguridad
3. Minimizar riesgos
   - Gestión de vulnerabilidades
   - Protección de servidores

### Protección por Capas
- Ningún sistema es completamente seguro
- Dificultar el acceso al atacante
- Proteger la información con múltiples capas
- Implementar defensa en profundidad

### Protección del Perímetro
- Análisis con Shodan
  - Búsqueda de dispositivos conectados
  - Detección de vulnerabilidades
  - Identificación de servicios expuestos
- Análisis con Nmap
  - Escaneo de puertos
  - Detección de servicios
  - Identificación de sistemas operativos
  - Análisis de vulnerabilidades

### Servicios Críticos
- SMBv1 (WannaCry, NotPetya)
- RDP (fuerza bruta)
- MSSQL (vulnerabilidades)
- Servicios web (exploits)

### Análisis de Red Interna
- Detección de servicios no estándar
- Monitoreo de conexiones
- Análisis de tráfico
- Identificación de anomalías

### Control de Aplicaciones
- Lista blanca de aplicaciones
- Políticas de restricción de software
- Auditoría de eventos
- Monitoreo de procesos

### Firewall de Windows
- Reglas de entrada/salida
- Perfiles de firewall
- Registro de eventos
- Bloqueo de conexiones no autorizadas

### Eventos de PowerShell
- Monitoreo de scripts
- Detección de comandos maliciosos
- Análisis de actividad sospechosa
- Registro de eventos de seguridad

### Comandos Útiles
```bash
# Escaneo de red
nmap -T4 -A -v -Pn [rango_ip]

# Análisis de servicios
nmap -sV -p [puertos] [ip]

# Monitoreo de eventos
wevtutil qe Security /f:text

# Configuración de firewall
netsh advfirewall show currentprofile
```

### Mejores Prácticas
1. Mantener sistemas actualizados
2. Implementar control de acceso
3. Monitorear eventos de seguridad
4. Realizar análisis periódicos
5. Documentar cambios y configuraciones 